@model BookReviewWeb.Models.Review
@{
    var bookDetailsUrl = Url.Page("/Library/Details", new { id = Model.BookId });
}

<a href="@bookDetailsUrl" class="text-decoration-none review-card-link">
    <div class="review-item card mb-3 shadow-sm">
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 col-sm-3 mb-3 mb-sm-0">
                    <div class="book-cover-container text-center">
                        @if (!string.IsNullOrEmpty(Model.Book.CoverImageUrl))
                        {
                            <img src="@Model.Book.CoverImageUrl" class="img-fluid rounded book-cover-small" alt="@Model.Book.Title">
                        }
                        else
                        {
                            <div class="placeholder-cover-small d-flex justify-content-center align-items-center bg-light rounded">
                                <i class="bi bi-book fs-3"></i>
                            </div>
                        }
                    </div>
                </div>
                <div class="col-md-10 col-sm-9">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <h5 class="mb-0">@Model.User.UserName</h5>
                            <small class="text-muted">
                                <i class="bi bi-book-fill me-1"></i>
                                @Model.Book.Title by @Model.Book.Author
                            </small>
                        </div>
                        <small class="text-muted">@Model.CreatedAt.ToString("MMM dd, yyyy")</small>
                    </div>
                    
                    <div class="rating mb-2">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <i class="fas @(i <= Model.Rating ? "fa-star text-warning" : "fa-star text-secondary")"></i>
                        }
                        <span class="ms-2 fw-bold">@Model.Rating/5</span>
                    </div>
                    
                    <p class="review-text-truncated">@Model.Comment</p>
                    
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted small">
                            <i class="bi bi-pencil-fill me-1"></i> 
                            @(ViewData["UserReviewCount"] != null ? ViewData["UserReviewCount"] : "0") review@(ViewData["UserReviewCount"] != null && (int)ViewData["UserReviewCount"] != 1 ? "s" : "")
                            
                            @if (ViewData["ReviewVotes"] != null)
                            {
                                var (upvotes, downvotes, total) = ((int, int, int))ViewData["ReviewVotes"];
                                <span class="ms-2 @(total > 0 ? "text-success" : total < 0 ? "text-danger" : "")">
                                    <i class="bi @(total > 0 ? "bi-hand-thumbs-up-fill" : total < 0 ? "bi-hand-thumbs-down-fill" : "bi-circle-fill")"></i>
                                    @total vote@(Math.Abs(total) != 1 ? "s" : "")
                                </span>
                            }
                        </div>
                        
                        @if (User.Identity.IsAuthenticated && 
                            (int.Parse(User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier).Value) == Model.UserId || 
                                User.IsInRole("Admin")))
                        {
                            <div class="review-actions" onclick="event.stopPropagation();">
                                <a asp-page="/Reviews/Edit" asp-route-id="@Model.Id" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                <a asp-page="/Reviews/Delete" asp-route-id="@Model.Id" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i> Delete
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</a> 